<html>
<script src='https://d3js.org/d3.v5.min.js'></script>
<body onload='init()'>
<svg width=900 height=900>
</svg>
<script src='https://d3js.org/d3.v5.min.js'></script>
<body onload='init()'>
<script>
async function init() {
	var diseases = ['ALZ','CAN','CLD','DIA','HOM','HTD','HYP','INJ','LIV','NEP','OTH','PNF','STK','SUI']
	var svg = d3.select("svg");
	var margin = 50;
	var width = svg.attr("width") - 2*margin;
	var height = svg.attr("height") - 2*margin;
	var x = d3.scaleBand().domain(diseases).range([0,width]);
	var y = d3.scaleLinear().domain([0,2305]).range([height,0]);
	var g = svg.append("g").attr("transform", "translate("+margin+","+margin+")");


	csv = await d3.csv("https://ShivanVipani.github.io/disease.csv");
	data = {}
	for (var i = 0; i < csv.length; i++) {
		if (csv[i]['County'] === 'Alameda') {
			var year = parseInt(csv[i]['year'])
			if (csv[i]['leadingcause'] in data) {
				data[csv[i]['leadingcause']][year-2017] += parseInt(csv[i]['Count']) || 0
			}
			else {
				data[csv[i]['leadingcause']] = [0,0,0,0]
				data[csv[i]['leadingcause']][year-2017] += parseInt(csv[i]['Count']) || 0
			}
		}
	}
	console.log(data)
	g.selectAll("rect").data(d3.entries(data))
	.enter().append("rect")
	.attr("x", function(d, i) { return x(diseases[i]); })
	.attr("y", function(d) { return y(d['value'][0]); })
	.attr("width", x.bandwidth())
	.attr("height", function(d) {return (height - y(d)); });

	d3.select("svg").append("g").attr("transform", "translate("+margin+","+margin+")").call(d3.axisLeft(y));
	d3.select("svg").append("g").attr("transform","translate(" +margin+ ","+ (height+margin)+")")
	.call(d3.axisBottom(x));


}

</script>
</body>
</html>
