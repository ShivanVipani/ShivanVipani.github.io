<html>
<script src='https://d3js.org/d3.v5.min.js'></script>
<style> rect {fill: lightblue; stroke: black;} </style>
<body onload='init()'>
<svg width=800 height=800>
</svg>
<script src='https://d3js.org/d3.v5.min.js'></script>
<body onload='init()'>
<script>
async function init() {
	var diseases = ['ALZ','CAN','CLD','DIA','HOM','HTD','HYP','INJ','LIV','NEP','OTH','PNF','STK','SUI']
	var svg = d3.select("svg");
	var margin = 50;
	var width = svg.attr("width") - 2*margin;
	var height = svg.attr("height") - 2*margin;
	var x = d3.scaleBand().domain(diseases).range([0,width]);
	var y = d3.scaleLinear().domain([0,2305]).range([height,0]);
	var g = svg.append("g").attr("transform", "translate("+margin+","+margin+")");


	csv = await d3.csv("https://ShivanVipani.github.io/disease.csv");
	data = {}
	for (var i = 0; i < csv.length; i++) {
		if (csv[i]['County'] === 'Alameda') {
			var year = parseInt(csv[i]['year'])
			if (csv[i]['leadingcause'] in data) {
				data[csv[i]['leadingcause']][year-2017] += parseInt(csv[i]['Count']) || 0
			}
			else {
				data[csv[i]['leadingcause']] = [0,0,0,0]
				data[csv[i]['leadingcause']][year-2017] += parseInt(csv[i]['Count']) || 0
			}
		}
	}
	var div = d3.select("svg").append("div")	
    .attr("class", "tooltip")				
    .style("opacity", 0);

	console.log(data)
	g.selectAll("rect").data(d3.entries(data))
	.enter().append("rect")
	.attr("x", function(d, i) { return x(diseases[i]); })
	.attr("y", function(d) { return y(d['value'][0]); })
	.attr("width", x.bandwidth())
	.attr("height", function(d) {return (height - y(d['value'][0])); })
	.on("mouseover", function(d) {div.style("opacity", .9)
		.style("left", d3.select(this).attr("x") + "px")		
        .style("top", (d3.select(this).attr("y") - 28) + "px")
        .html(d['value'][0]);})	
    .on("mouseleave", function(d) {div.style("opacity", 0);	})

	d3.select("svg").append("g").attr("transform", "translate("+margin+","+margin+")").call(d3.axisLeft(y));
	d3.select("svg").append("g").attr("transform","translate(" +margin+ ","+ (height+margin)+")")
	.call(d3.axisBottom(x));


}

</script>
</body>
</html>
